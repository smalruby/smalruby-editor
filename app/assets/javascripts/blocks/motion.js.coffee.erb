# 「動き」ジャンル

<%
  prefix = 'motion'
  color = 225
%>

# (　)歩動かす
<% n = "#{prefix}_move" %>
Blockly.Blocks['<%= n %>'] =
  init: ()->
    @.setHelpUrl('')
    @.setColour(<%= color %>)
    @.appendValueInput('STEP').setCheck('Number')
    @.appendDummyInput().appendField('歩動かす')
    @.setInputsInline(true)
    @.setPreviousStatement(true)
    @.setNextStatement(true)
    @.setTooltip('')

Blockly.Ruby['<%= n %>'] = (block) ->
  arg = Blockly.Ruby.valueToCode(@, 'STEP', Blockly.Ruby.ORDER_NONE) || '0'
  "move(#{arg})\n"

# x座標を(　)、y座標を(　)にする
<% n = "#{prefix}_instance_variable_set_x_y" %>
Blockly.Blocks['<%= n %>'] =
  init: ()->
    @.setHelpUrl('')
    @.setColour(<%= color %>)
    @.appendDummyInput().appendField('X座標を')
    @.appendValueInput('X').setCheck('Number')
    @.appendDummyInput().appendField('、Y座標を')
    @.appendValueInput('Y').setCheck('Number')
    @.appendDummyInput().appendField('にする')
    @.setInputsInline(true)
    @.setPreviousStatement(true)
    @.setNextStatement(true)
    @.setTooltip('')

Blockly.Ruby['<%= n %>'] = (block) ->
  x = Blockly.Ruby.valueToCode(@, 'X', Blockly.Ruby.ORDER_NONE) || '0'
  y = Blockly.Ruby.valueToCode(@, 'Y', Blockly.Ruby.ORDER_NONE) || '0'
  """
  self.x = #{x}
  self.y = #{y}

  """

# もし端に着いたら、跳ね返る
<% n = "#{prefix}_turn_if_reach_wall" %>
Blockly.Blocks['<%= n %>'] =
  init: ()->
    @.setHelpUrl('')
    @.setColour(<%= color %>)
    @.appendDummyInput().appendField('もし端に着いたら、跳ね返る')
    @.setPreviousStatement(true)
    @.setNextStatement(true)
    @.setTooltip('')

Blockly.Ruby['<%= n %>'] = (block) ->
  'turn_if_reach_wall\n'

# 条件:端に着いた
<% n = "#{prefix}_reach_wall" %>
Blockly.Blocks['<%= n %>'] =
  init: ()->
    @.setHelpUrl('')
    @.setColour(<%= color %>)
    @.appendDummyInput().appendField('端に着いた')
    @.setOutput(true, 'Boolean')
    @.setTooltip('')

Blockly.Ruby['<%= n %>'] = (block) ->
  ['reach_wall?', Blockly.Ruby.ORDER_ATOMIC]

# 跳ね返る
<% n = "#{prefix}_turn" %>
Blockly.Blocks['<%= n %>'] =
  init: ()->
    @.setHelpUrl('')
    @.setColour(<%= color %>)
    @.appendDummyInput().appendField('跳ね返る')
    @.setPreviousStatement(true)
    @.setNextStatement(true)
    @.setTooltip('')

Blockly.Ruby['<%= n %>'] = (block) ->
  'turn\n'

# 変数:x座標
<% n = "#{prefix}_self_x" %>
Blockly.Blocks['<%= n %>'] =
  init: ()->
    @.setHelpUrl('')
    @.setColour(<%= color %>)
    @.appendDummyInput().appendField('x座標')
    @.setOutput(true, 'Number')
    @.setTooltip('')

Blockly.Ruby['<%= n %>'] = (block) ->
  ['x', Blockly.Ruby.ORDER_ATOMIC]

# 変数:y座標
<% n = "#{prefix}_self_y" %>
Blockly.Blocks['<%= n %>'] =
  init: ()->
    @.setHelpUrl('')
    @.setColour(<%= color %>)
    @.appendDummyInput().appendField('y座標')
    @.setOutput(true, 'Number')
    @.setTooltip('')

Blockly.Ruby['<%= n %>'] = (block) ->
  ['y', Blockly.Ruby.ORDER_ATOMIC]
